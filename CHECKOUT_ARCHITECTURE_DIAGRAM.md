# ğŸ¨ Diagrama Visual - Arquitetura do Checkout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ğŸŒ FRONTEND (Next.js)                              â”‚
â”‚                         app/checkout/page.tsx                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    âœ¨ Seu Checkout Bonito                             â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  ğŸ“ FormulÃ¡rio de Dados      ğŸ¨ Design Customizado                   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Nome                    â”‚  â€¢ Cores da sua marca                â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Email                   â”‚  â€¢ Layout otimizado                  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ CPF                     â”‚  â€¢ AnimaÃ§Ãµes suaves                  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Telefone                â”‚  â€¢ Mobile-first                      â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  ğŸ Order Bumps               ğŸ’³ Formas de Pagamento                 â”‚  â”‚
â”‚  â”‚  â”‚  â˜‘ VIP (R$ 147)            â”‚  â—‹ PIX (5% desconto)                â”‚  â”‚
â”‚  â”‚  â”‚  â˜‘ Biblioteca (R$ 97)      â”‚  â— CartÃ£o de CrÃ©dito                â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  [  Finalizar Compra Segura  ] ğŸ”’                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                          â”‚
â”‚                                    â”‚ onClick                                  â”‚
â”‚                                    â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  handleCheckout() {                                                   â”‚  â”‚
â”‚  â”‚    const data = {                                                     â”‚  â”‚
â”‚  â”‚      name, email, cpf, phone,                                        â”‚  â”‚
â”‚  â”‚      paymentMethod: 'pix',                                           â”‚  â”‚
â”‚  â”‚      orderBumps: [0, 1],                                             â”‚  â”‚
â”‚  â”‚      cardData: { ... }                                               â”‚  â”‚
â”‚  â”‚    }                                                                  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚    fetch('/api/checkout', {                                          â”‚  â”‚
â”‚  â”‚      method: 'POST',                                                 â”‚  â”‚
â”‚  â”‚      body: JSON.stringify(data)                                      â”‚  â”‚
â”‚  â”‚    })                                                                 â”‚  â”‚
â”‚  â”‚  }                                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTP POST
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸ”§ SUA API (Next.js Backend)                            â”‚
â”‚                     app/api/checkout/route.ts                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  1ï¸âƒ£  Recebe dados do frontend                                                â”‚
â”‚      { name, email, cpf, paymentMethod, orderBumps, cardData }              â”‚
â”‚                                                                               â”‚
â”‚  2ï¸âƒ£  Valida dados                                                            â”‚
â”‚      âœ“ Email vÃ¡lido?                                                         â”‚
â”‚      âœ“ CPF vÃ¡lido?                                                           â”‚
â”‚      âœ“ Campos obrigatÃ³rios preenchidos?                                     â”‚
â”‚                                                                               â”‚
â”‚  3ï¸âƒ£  Mapeia Order Bumps                                                      â”‚
â”‚      [0, 1] â†’ [{ product_id: 'VIP' }, { product_id: 'LIBRARY' }]           â”‚
â”‚                                                                               â”‚
â”‚  4ï¸âƒ£  Chama lib/appmax.ts                                                     â”‚
â”‚      createAppmaxOrder({                                                     â”‚
â”‚        customer: { ... },                                                    â”‚
â”‚        product_id: '32880073',                                              â”‚
â”‚        payment_method: 'pix',                                               â”‚
â”‚        order_bumps: [...]                                                    â”‚
â”‚      })                                                                      â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTP POST
                                    â”‚ Authorization: Bearer TOKEN
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ğŸ¢ APPMAX API                                          â”‚
â”‚                  api.appmax.com.br/v1/orders                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  5ï¸âƒ£  Recebe pedido                                                           â”‚
â”‚      { customer, product_id, payment_method, order_bumps }                  â”‚
â”‚                                                                               â”‚
â”‚  6ï¸âƒ£  Valida dados                                                            â”‚
â”‚      âœ“ Token vÃ¡lido?                                                         â”‚
â”‚      âœ“ Produto existe?                                                       â”‚
â”‚      âœ“ Dados completos?                                                      â”‚
â”‚                                                                               â”‚
â”‚  7ï¸âƒ£  Processa pagamento                                                      â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚      â”‚  Se PIX:            â”‚     â”‚  Se CartÃ£o:         â”‚                   â”‚
â”‚      â”‚  â€¢ Gera QR Code     â”‚     â”‚  â€¢ Valida cartÃ£o    â”‚                   â”‚
â”‚      â”‚  â€¢ Cria cobranÃ§a    â”‚     â”‚  â€¢ Processa         â”‚                   â”‚
â”‚      â”‚  â€¢ Status: pending  â”‚     â”‚  â€¢ Pode ser 3DS     â”‚                   â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                               â”‚
â”‚  8ï¸âƒ£  Retorna resposta                                                        â”‚
â”‚      {                                                                       â”‚
â”‚        success: true,                                                        â”‚
â”‚        order_id: 'ABC123',                                                   â”‚
â”‚        status: 'pending',                                                    â”‚
â”‚        pix_qr_code: '00020126...',                                          â”‚
â”‚        pix_qr_code_base64: 'data:image/png;base64...'                       â”‚
â”‚      }                                                                       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTP Response
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸ”§ SUA API (Response)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  9ï¸âƒ£  Retorna para frontend                                                   â”‚
â”‚      {                                                                       â”‚
â”‚        success: true,                                                        â”‚
â”‚        orderId: 'ABC123',                                                    â”‚
â”‚        pixQrCodeBase64: '...'                                               â”‚
â”‚      }                                                                       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTP Response
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ğŸŒ FRONTEND (Resposta)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  ğŸ”Ÿ Exibe resultado                                                           â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Se PIX:                       â”‚    â”‚  Se CartÃ£o Aprovado:           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚                                â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ’° Pague com PIX        â”‚  â”‚    â”‚  âœ… Pagamento Aprovado!       â”‚  â”‚
â”‚  â”‚  â”‚                          â”‚  â”‚    â”‚                                â”‚  â”‚
â”‚  â”‚  â”‚  [QR Code Image]         â”‚  â”‚    â”‚  Redirecionando para          â”‚  â”‚
â”‚  â”‚  â”‚                          â”‚  â”‚    â”‚  Ã¡rea de membros...           â”‚  â”‚
â”‚  â”‚  â”‚  Aguardando pagamento... â”‚  â”‚    â”‚                                â”‚  â”‚
â”‚  â”‚  â”‚  â³â³â³                     â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                         â”‚
â”‚  â”‚                                 â”‚                                         â”‚
â”‚  â”‚  [Polling a cada 3 segundos]   â”‚                                         â”‚
â”‚  â”‚          â”‚                      â”‚                                         â”‚
â”‚  â”‚          â–¼                      â”‚                                         â”‚
â”‚  â”‚  GET /api/checkout/status      â”‚                                         â”‚
â”‚  â”‚          â”‚                      â”‚                                         â”‚
â”‚  â”‚          â–¼                      â”‚                                         â”‚
â”‚  â”‚  Status: approved? â†’ Success!  â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                         ğŸ”” WEBHOOK FLOW (AssÃ­ncrono)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° Cliente paga (PIX escaneado / CartÃ£o processado)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Pagamento Confirmado
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ğŸ¢ APPMAX                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1ï¸âƒ£  Detecta pagamento aprovado                                              â”‚
â”‚  2ï¸âƒ£  Atualiza status do pedido                                               â”‚
â”‚  3ï¸âƒ£  Dispara webhook para seu sistema                                        â”‚
â”‚                                                                               â”‚
â”‚      POST https://seusite.com/api/webhook/appmax                            â”‚
â”‚      Headers:                                                                â”‚
â”‚        X-Appmax-Signature: sha256=...                                       â”‚
â”‚      Body:                                                                   â”‚
â”‚        {                                                                     â”‚
â”‚          event: 'order.approved',                                           â”‚
â”‚          order_id: 'ABC123',                                                â”‚
â”‚          customer: { name, email, cpf },                                    â”‚
â”‚          product_id: '32880073',                                            â”‚
â”‚          amount: 36.00                                                      â”‚
â”‚        }                                                                     â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTP POST (Webhook)
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ğŸ”” SEU WEBHOOK HANDLER                                      â”‚
â”‚               app/api/webhook/appmax/route.ts                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  1ï¸âƒ£  Valida assinatura (X-Appmax-Signature)                                  â”‚
â”‚      HMAC SHA256 com APPMAX_WEBHOOK_SECRET                                  â”‚
â”‚                                                                               â”‚
â”‚  2ï¸âƒ£  Verifica se evento jÃ¡ foi processado                                    â”‚
â”‚      (evitar duplicatas)                                                     â”‚
â”‚                                                                               â”‚
â”‚  3ï¸âƒ£  Extrai dados do pedido                                                  â”‚
â”‚      { order_id, customer, product_id }                                     â”‚
â”‚                                                                               â”‚
â”‚  4ï¸âƒ£  Libera acesso ao produto                                                â”‚
â”‚      â€¢ Salva no banco de dados (Supabase)                                   â”‚
â”‚      â€¢ Atualiza tabela de usuÃ¡rios                                          â”‚
â”‚      â€¢ Marca produto como "ativo"                                           â”‚
â”‚                                                                               â”‚
â”‚  5ï¸âƒ£  Envia email de boas-vindas                                              â”‚
â”‚      ğŸ“§ "Seu acesso foi liberado!"                                           â”‚
â”‚      Com credenciais e link de login                                        â”‚
â”‚                                                                               â”‚
â”‚  6ï¸âƒ£  Retorna 200 OK                                                          â”‚
â”‚      (importante para Appmax saber que webhook foi processado)              â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                         ğŸ“Š FLUXO DE DADOS COMPLETO
================================================================================

   CLIENTE                 SEU SITE                API APPMAX           BANCO
     â”‚                         â”‚                        â”‚                 â”‚
     â”‚  1. Preenche checkout   â”‚                        â”‚                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚                 â”‚
     â”‚                         â”‚  2. POST /orders       â”‚                 â”‚
     â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
     â”‚                         â”‚                        â”‚ 3. Processa     â”‚
     â”‚                         â”‚                        â”‚    pagamento    â”‚
     â”‚                         â”‚  4. Retorna QR Code    â”‚                 â”‚
     â”‚  5. Mostra QR Code      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚                 â”‚
     â”‚                         â”‚                        â”‚                 â”‚
     â”‚  6. Paga PIX            â”‚                        â”‚                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
     â”‚                         â”‚                        â”‚                 â”‚
     â”‚                         â”‚       7. Webhook       â”‚                 â”‚
     â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
     â”‚                         â”‚                        â”‚                 â”‚
     â”‚                         â”‚                    8. Salva no banco     â”‚
     â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                         â”‚                        â”‚                 â”‚
     â”‚  9. Redireciona         â”‚                        â”‚                 â”‚
     â”‚     para /dashboard     â”‚                        â”‚                 â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚                 â”‚
     â”‚                         â”‚                        â”‚                 â”‚
     âœ“ Acesso liberado!        âœ“ Processamento OK      âœ“ Pedido criado   âœ“ Dados salvos


================================================================================
                         ğŸ” SEGURANÃ‡A E VALIDAÃ‡Ã•ES
================================================================================

1. Frontend â†’ Backend
   âœ“ ValidaÃ§Ã£o de campos (email, CPF, cartÃ£o)
   âœ“ HTTPS obrigatÃ³rio
   âœ“ Rate limiting (prevenir spam)

2. Backend â†’ Appmax
   âœ“ Token Bearer em headers
   âœ“ Dados sanitizados
   âœ“ Retry logic com backoff

3. Appmax â†’ Webhook
   âœ“ ValidaÃ§Ã£o de assinatura (HMAC SHA256)
   âœ“ VerificaÃ§Ã£o de duplicatas
   âœ“ HTTPS obrigatÃ³rio
   âœ“ Response rÃ¡pida (< 5s)

4. Dados SensÃ­veis
   âœ“ CartÃ£o processado pela Appmax (PCI compliance)
   âœ“ Nunca armazenar dados de cartÃ£o
   âœ“ Tokens em variÃ¡veis de ambiente
   âœ“ Logs sem dados sensÃ­veis

================================================================================
